# YummyVerse Database Server

## 概要
このリポジトリはYummyVerse用のデータベースサーバのコードです.

## 注意
このサーバにおける`user_id`はすべて, pythonの`uuid`ライブラリで生成されるUUID形式の文字列, もしくはUUIDクラスインスタンスであることを前提としています. APIを利用する際は, **文字列形式のUUIDを使用してください.**

# 使い方
## サーバの起動
以下の手順でサーバを起動できます.

1. `uv sync`コマンドを実行して依存関係をインストールします.
2. `uv run src/entry.py -p <port_number>`コマンドを実行してサーバを起動します.
    - `-p`オプションでサーバのポート番号を指定します.
    - `--debug`オプションを付与すると, デバッグモードで起動します. デバッグモードでは, デバイスサーバやコントロールサーバへの通知が行われません.
3. サーバはデフォルト設定で`http://0.0.0.0:8000`に起動します.

各オプションの詳細については`python src/entry.py -h`コマンドで確認できます.

## APIの利用
APIを利用する場合は, HTTPクライアントを使用して各エンドポイントにリクエストを送信してください. FastAPIを利用しているので, `/docs`エンドポイントで自動生成されたAPIドキュメントも利用できます.

APIを利用する場合は以下の手順に従ってください.
1. `create/user`エンドポイントで新しいユーザーを作成
2. `save/model`および`save/audio`エンドポイントでモデルデータと音声データを保存
3. `{user_id}/status`エンドポイントでデータの準備状況を確認
4. `{user_id}/model`および`{user_id}/audio`エンドポイントで保存されたデータを取得

## APIエンドポイント
このサーバは以下のAPIエンドポイントを提供します. 詳細な仕様についてはFastAPIの自動生成ドキュメント`http://0.0.0.0/8000/docs`を参照してください.
- `/notify/{user_id}`: ユーザーの通知
    - メソッド: POST
    - 説明: Quest3で読み取られたユーザーIDを受け取り, 物理デバイスをコントロールするサーバに通知します.

- `/{user_id}/status`: ユーザーステータスの取得
    - メソッド: GET
    - 説明: 指定されたユーザーのデータステータスを取得します. すべてのデータが準備できている場合は`true`を返します.

- `/create/user`: ユーザーの作成
    - メソッド: POST
    - 説明: 指定されたIDを持つ, 新しいユーザーを作成します.
    - リクエストの引数:
        - `user_id` (str): ユーザーID

- `/save/model`: モデルデータの保存
    - メソッド: POST
    - 説明: 指定されたモデルデータをユーザに紐づけて保存します.
    - リクエストの引数:
        - `user_id` (str): ユーザーID
        - `model_data` (str): モデルデータ (Base64エンコードされた文字列) < 怪しい

- `/save/audio`: 音声データの保存
    - メソッド: POST
    - 説明: 指定された音声データをユーザに紐づけて保存します.
    - リクエストの引数:
        - `user_id` (str): ユーザーID
        - `audio_data` (str): 音声データ (Base64エンコードされた文字列) < 怪しい

- `/save/param`: パラメータデータの保存
    - メソッド: POST
    - 説明: 指定されたパラメータデータをユーザに紐づけて保存します.
    - リクエストの引数:
        - `user_id` (str): ユーザーID
        - `param_data` (str): パラメータデータ (Base64エンコードされた文字列) < 怪しい

- `/{user_id}/model`: モデルデータの取得
    - メソッド: GET
    - 説明: 指定されたユーザーのモデルデータを取得します.

- `/{user_id}/audio`: 音声データの取得
    - メソッド: GET
    - 説明: 指定されたユーザーの音声データを取得します

- `/{user_id}/param`: パラメータデータの取得
    - メソッド: GET
    - 説明: 指定されたユーザーのパラメータデータを取得します
